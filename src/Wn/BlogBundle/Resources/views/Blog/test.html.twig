{% extends "WnBlogBundle::test.html.twig" %}
{% block title %}Homepage{% endblock %}
{% block javascript %}
<script type="text/javascript">
$(document).ready(function(){
	var container = $('#container');
	$('.connexion').modal_box({
		contenu : '<form action="{{ path("fos_user_security_check") }}" method="post">'
					+'<label for="username">Login</label>'
					+'<input type="text" id="username" name="_username"  required="required" />'
					+'<label for="password">Password</label>'
					+'<input type="password" id="password" name="_password" required="required" />'
                    +'<label for="remember_me">'
                    +'<input type="checkbox" id="remember_me" name="_remember_me" value="on" /> Remember me</label>'
					+'<button type="submit" id="_submit" >{{ "security.login.submit"|trans({}, "FOSUserBundle")}}</button>'
					+'</form>'
	});

	$('#container').imagesLoaded(function(){
		$('#container').masonry({
			itemSelector : '.element',
			gutter : 22
		});

		var blogLink = $("nav a:contains('Blog Perso')");
		blogLink.click(function(){
			updateNav($(this));
			var $elements = $('.element');
			$elements.removeClass("element-hide");
			$("#container").masonry('layout');
		});

		var galerieLink = $("nav a:contains('Galerie')");
		galerieLink.click(function(){
			updateNav($(this));
			var $imageElement = $('.element-image');
			var $otherElement = $('.element').not('.element-image').not('.element-antibug');
			$otherElement.addClass('element-hide');
			$imageElement.removeClass('element-hide');
			$('#container').masonry('layout');
		});

		var model3DLink = $("nav a:contains('Model 3D')");
		model3DLink.click(function(){
			updateNav($(this));
			var $modelElement = $('.element-model3D');
			var $otherElement = $('.element').not('.element-model3D').not('.element-antibug');
			$otherElement.addClass('element-hide');
			$modelElement.removeClass('element-hide');
			$('#container').masonry('layout');
		});

		function updateNav(link){
			$('nav a[class="actif"]').removeClass("actif");
			link.addClass("actif");
		}

		{% for categorie in categories %}
		$("nav a:contains('{{categorie.nom}}')").click(function(){
			updateNav($(this));
			var $categorieElement = $('.categorie-{{categorie.nom}}');
			var $otherElement     = $('.element').not('.categorie-{{categorie.nom}}').not('.element-antibug');
			$otherElement.addClass('element-hide');
			$categorieElement.removeClass('element-hide');
			$('#container').masonry('layout');
		});
		{% endfor %}

		$(window).scroll(function(){
			if($(window).scrollTop() + $(window).height() == $(document).height()){
				$.ajax({
					type: "POST",
					url: "{{ path('wn_blog_index_element') }}",
					cache: false,
					dataType: 'html',
					success: function(data){
						console.log("ding");
						var $html = $( data );
						//container.append($html).masonry( 'appended', $html, true ).masonry('layout',$html);
					},
					error: function(data){
						console.log("dong");
					}
				});
			}
		});

	});


	

});
</script>
{% endblock javascript %}
{% block container %}

<div id="container">
	<div class="element element-antibug"></div>
	{% for element in elements %}

		{# Representation des articles #}
		{% if element is wn_article %}
			{{ render(controller("WnBlogBundle:Article:elementIndex", {'article' : element })) }}
		{# Representation des images de la galerie #}
		{% elseif element is wn_elementGalerie %}
			{{ render(controller("WnGalerieBundle:ElementGalerie:elementIndex", {'elementGalerie' : element })) }}
		{# Representation des model3D#}
		{% elseif element is wn_model3d %}
			{{ render(controller("WnModel3DBundle:Model3D:elementIndex",{'model': element })) }}
		{% endif %}

	{% endfor %}

	<div class="element loader"></div>
{% endblock container %}