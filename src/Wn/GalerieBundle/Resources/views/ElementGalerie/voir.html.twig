{% extends "WnBlogBundle::layout.html.twig" %}

{% block css %}
{{ parent() }}
{% stylesheets "@WnBlogBundle/Resources/public/css/commentaires.css"
			   "@WnGalerieBundle/Resources/public/css/image.css"
			   "@WnGalerieBundle/Resources/public/css/description.css" %}
<link rel="stylesheet" type="text/css" href="{{asset_url}}">
{% endstylesheets %}
{% endblock css%}

{% block nav %}
{{ render(controller('WnBlogBundle:Article:menu')) }}
{% endblock nav %}

{% block container %}
<div id="container">
	<script type="text/javascript">
		$(document).ready(function(){
			$('#container').imagesLoaded(function(){
				$('#container').masonry({
					itemSelector : '.element',
					gutter : 2,
				});
				$('#container').masonry('layout');
			});
		});
	</script>
	<div class="element element-antibug"></div>
	<img class="element element-image" src="{{ asset(image.WebPath) }}">
	<div class="commentaires element">
		<div class="description">
			<div class="auteur-date">
				<span class="icon-user avatar inline"></span>
				<div class="info inline">
					<a href="{{path('wn_blog_utilisateur',{'id' : image.auteur.id })}}" class="auteur">{{image.auteur.username}}</a>
					<br/>
					<span class="date">{{image.datePublication | date('d-m-Y')}}</span>
				</div>
			</div>
			<p>Description : {{ image.note }}</p>
		</div>
		<div class="ban"><span class="text">Commentaire</span></div>
		{# Formulaire pour mettre un commentaire #}
		<form method="post" {{ form_enctype(form)}}>
			{{ form_errors(form) }}
			{% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
				{{ form_widget(form.contenu, {'attr':{'placeholder' : 'Entrer votre commentaire ici.'} }) }}
			{% else %}
				{{ form_widget(form.contenu, {'attr':{'placeholder' : 'Veuillez vous connecter pour écrire un commentaire sur cette article.', 'disabled' : 'disabled'} }) }}
			{% endif %}
				{{ form_rest(form) }}
			{% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
				<input type="submit" value="Envoyer"/>
			{% else %}
				<input type="submit" value="Envoyer" disabled />
			{% endif %}
		</form>
		

		{# Liste des commentaires #}
		{% if commentaires|length == 0 %}
		<div class="ban ban-0commentaire">
			<span class="text">Cette article n'a pas encore été commenté</span>
		</div>
		{% endif %}
		{% for commentaire in commentaires %}
		<div class="commentaire">
			<div class="auteur">
				<div class="triangle">
					<div class="triangle-bleu"></div>
					<div class="triangle-blanc"></div>
				</div>
				<span class="icon-user avatar"></span>
				<a href="{{ path('wn_blog_utilisateur',{'id':commentaire.auteur.id}) }}" class="pseudo">{{ commentaire.auteur.username }}</a>
			</div>
			<div class="contenu">
				<p>{{ commentaire.contenu }}</p>
			</div>
		</div><!-- commentaire -->
		{% endfor %}
	</div><!-- commentaires -->
</div>
{% endblock container %}